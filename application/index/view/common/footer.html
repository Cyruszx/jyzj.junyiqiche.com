<script src="https://cdn.bootcss.com/jquery/3.4.0/jquery.min.js"></script>
<script src="//layui.hcwl520.com.cn/layui/layui.js?v=201801090202"></script>
<script src="https://res.wx.qq.com/open/js/jweixin-1.4.0.js" type="text/javascript" charset="utf-8"></script>


<!--您的Layui代码start-->
<script type="text/javascript">
    window.onload = function () {
        var ajaxurl = '{:url("index/sharedata")}';
        var urll = location.href.split('#')[0];
        $.ajax({
            url: ajaxurl,
            type: "post",
            data: {urll: urll},
            dataType: "json",
            success: function (s) {
                f = $.parseJSON(s);
                console.log(f.url+'22222222222222222222222222222222');

                wx.config({
                    debug: false, //分享成功后可以关闭 false
                    appId: f.appid,
                    timestamp: f.timestamp,
                    nonceStr: f.nonceStr,
                    signature: f.signature,
                    jsApiList: ['onMenuShareTimeline', 'onMenuShareAppMessage']
                });
                wx.ready(function () {
                    /*   wx.checkJsApi({
                           jsApiList: [
                               'getNetworkType',
                               'previewImage'
                           ],
                           success: function (res) {
                               // alert("checkJsApi=="+ JSON.stringify(res));
                           }
                       });*/
                    wx.onMenuShareTimeline({
                        title: '{$share_title}', // 分享标题
                        link: 'http://jyzj.junyiqiche.com/index', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                        imgUrl: "{$share_img}", // 分享图标 使用绝对路径
                        success: function () {

                        }
                    });
                    wx.onMenuShareAppMessage({
                        title: '{$share_title}',
                        desc: "{$share_body}", // 分享描述
                        link: 'http://jyzj.junyiqiche.com/index', // 分享链接，该链接域名或路径必须与当前页面对应的公众号JS安全域名一致
                        imgUrl: "{$share_img}", // 分享图标 使用绝对路径
                        type: '', // 分享类型,music、video或link，不填默认为link
                        dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
                        success: function () {

                        }
                    });
                });

            },
            error: function () {
                console.log("通信失败");
            }
        })
    }
    window.ontouchmove = function (e) {
        e.preventDefault && e.preventDefault();
        e.returnValue = false;
        e.stopPropagation && e.stopPropagation();
        return false;
    };
    layui.use(['form', 'element'], function () {

        var form = layui.form
            , element = layui.element; //元素操作
        ;
        form.on('submit(formDemo)', function (data) {

            if ($('button[lay-filter="formDemo"]').is(':visible')) {

                var load = layer.load(2);
                $.post("{:url('index/getDriverInfo')}", data.field, function (res) {
                    console.log(res);
                    if (res.code == 1) {
                        $('button[lay-filter="formDemo"]').hide();
                        $('.formDemo2').show();
                        $('input[type="hidden"]').val(res.data.id);

                        layer.close(load);

                        $('.applyInfo').html(
                            "姓名：" + res.data.username + '<br>身份证号：'
                            + res.data.id_card + '<br>' + '购入车型：'
                            + res.data.models_name + '<br>车牌号：'
                            + res.data.orderdetails.licensenumber + '<br>车架号：'
                            + res.data.orderdetails.frame_number + '<br> 发动机号：'
                            + res.data.orderdetails.engine_number
                        );
                    }
                    else {
                        layer.close(load);
                        layer.msg(res.msg);
                    }

                });
            }
            return false;
        })
        $('.formDemo2').on('click', function () {
            // alert($('input[type="hidden"]').val());return;
            $.post("{:url('index/applyDriverInfo')}", {
                order_id: $('input[type="hidden"]').val(),
                is_apply: 1
            }, function (res) {
                if (res.code == 1) {
                    layer.msg(res.msg);
                    parent.location.reload();
                }
                else {
                    layer.msg(res.msg);
                }

            })
            return false;

        })
        /*layer弹出一个示例*/
        // layer.msg('Hello World');
    });
</script>


</body>
</html>